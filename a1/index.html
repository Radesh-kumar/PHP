<!-- 											Drawbacks

We can give same id to different user
it will show the first id of the users who have same multiple id
it will delete all users who have same multiple id




-->
<html>
	<head>
		<title>Learn Ajax</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" href="style.css" >
		<link href="img/favicon.png" rel="icon">
		<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
		<script>

			// Ajaxify the whole data from the process_ajax.php
			function ajax_func(){

				xmlhttp = new XMLHttpRequest();

				xmlhttp.onreadystatechange = function (){
					if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
						document.getElementById('ret_data').innerHTML = xmlhttp.responseText;
					}
				}
				xmlhttp.open('GET', 'process_ajax.php', true);
				xmlhttp.send();
			}

			// Inserting data to the database
			function submit_form(){

				var user_form = document.getElementById('user_form');

				var username = document.getElementById('username').value,
					email = document.getElementById('email').value,
					contactnumber = document.getElementById('contactnumber').value,
					notes = document.getElementById('notes').value,
					id= document.getElementById('id').value;

					//Ajax Processing from here

					xmlhttp.onreadystatechange = function (){
						if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
							document.getElementById('ret_data').innerHTML = xmlhttp.responseText;
						}
					}

					xmlhttp.open('GET', 'process_ajax.php?submit_form=yes&name='+username+'&email='+email+'&id='+id+'&contactnumber='+contactnumber+'&notes='+notes, true);
					xmlhttp.send();
					// Ajax Ending

					$('#add_new_person').modal('hide');

					user_form.reset();


				return false;
				//Stops reloading page
				//You will only notice when u clearly notice on background
			}

			// Deleting data from the database

			function delete_func(del_id){

				xmlhttp.onreadystatechange = function (){
					if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
						document.getElementById("ret_data").innerHTML = xmlhttp.responseText;
					}
				}

				xmlhttp.open('GET', 'process_ajax.php?del_id='+del_id, true);
				xmlhttp.send();
			}

			// Edit Function

			function edit_form(x){
				//Here x is the id of the row sent by the button edit
				var edit_form = document.getElementById('edit_form'+x);
				//Getting values from the modal with id x
				var edit_username = document.getElementById('edit_username'+x).value,
					edit_email = document.getElementById('edit_email'+x).value,
					edit_contactnumber = document.getElementById('edit_contactnumber'+x).value,
					edit_notes = document.getElementById('edit_notes'+x).value,
					edit_id=document.getElementById('edit_id'+x).value;

					xmlhttp.open('GET', 'process_ajax.php?edit_form=yes&ed_id='+x+'&edit_username='+edit_username+'&edit_id='+edit_id+'&edit_email='+edit_email+'&edit_contactnumber='+edit_contactnumber+'&edit_notes='+edit_notes, true);
					xmlhttp.send();


					$('#edit_person'+x).modal('hide');
					edit_form.reset();
					return false;
					//Stops reloading page
			}

		</script>
	</head>
	<body onload="ajax_func();">
		<div class="container">
			<br><br>
			<button class="btn btn-primary btn-lg" data-toggle="modal" data-backdrop="static" data-target="#add_new_person">Add New Person</button><br><br>

			<div class="modal fade" id="add_new_person">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button class="close" data-dismiss="modal">&times;</button>
							<h4>Add New Person</h4>
						</div>
						<div class="modal-body">

							<form onsubmit="return submit_form();" id="user_form">
								<div class="form-group">
									<label>Id</label>
									<input type="text" id="id" class="form-control" required>
								</div>
								<div class="form-group">
									<label>Name</label>
									<input type="text" id="username" class="form-control" required>
								</div>
								<div class="form-group">
									<label>E-mail</label>
									<input type="text" id="email" class="form-control" required>
								</div>
								<div class="form-group">
									<label>Contact Number</label>
									<input type="text" id="contactnumber" class="form-control" required>
								</div>
								<div class="form-group">
									<label>Notes</label>
									<textarea class="form-control" id="notes"></textarea>
								</div>
								<div class="form-group">
									<button class="btn btn-info btn-block btn-lg">Submit</button>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<div class="text-right">
								<button class="btn btn-danger" data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<br>
			<div class="table">
			<table class="table table-bordered text-center" >
				<thead>
					<tr>
						<th>S.No</th>
						<th>Id</th>
						<th>Name</th>
						<th>Email</th>
						<th>Contact Number</th>
						<th>Notes</th>
						<th>Edit / Delete</th>
					</tr>
				</thead>
				<tbody id="ret_data">

				</tbody>
			</table>
			</div>
		</div>
	</body>
</html>
